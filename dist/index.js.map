{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import firebase from 'firebase/app';\nimport 'firebase/firestore';\nimport { useCallback, useEffect, useState } from 'react';\n\ntype Query = firebase.firestore.Query;\ntype DocumentData = firebase.firestore.DocumentData;\ntype QuerySnapshot = firebase.firestore.QuerySnapshot;\ntype IUseFirestorePagination = [\n  items: QuerySnapshot | undefined,\n  next: () => void,\n  previous: () => void,\n  setLimit: (newLimit: number) => void,\n  isLoading: boolean,\n  page: number,\n  size: number,\n];\n\nconst useFirestorePagination = (\n  query: Query,\n  initialLimit: number = 10,\n): IUseFirestorePagination => {\n  const [currentLimit, setCurrentLimit] = useState(initialLimit);\n  const [firstDoc, setFirstDoc] = useState<DocumentData>();\n  const [lastDoc, setLastDoc] = useState<DocumentData>();\n  const [currentQuery, setCurrentQuery] = useState<Query>(query.limit(initialLimit));\n\n  const [size, setSize] = useState(0);\n  const [items, setItems] = useState<QuerySnapshot>();\n  const [page, setPage] = useState(0);\n  const [isLoading, setLoading] = useState(false);\n\n  useEffect(() => {\n    query.get().then((snapshot) => setSize(snapshot.size));\n  }, []);\n\n  useEffect(() => {\n    setLoading(true);\n    currentQuery.get().then((snapshot) => {\n      setLoading(false);\n      setItems(snapshot);\n      setFirstDoc(snapshot.docs[0]);\n      setLastDoc(snapshot.docs[snapshot.docs.length - 1]);\n    });\n  }, [currentQuery]);\n\n  const next = useCallback(() => {\n    setPage((page) => page + 1);\n    setCurrentQuery(query.startAfter(lastDoc).limit(currentLimit));\n  }, [lastDoc]);\n  const previous = useCallback(() => {\n    setPage((page) => page - 1);\n    setCurrentQuery(query.endBefore(firstDoc).limitToLast(currentLimit));\n  }, [firstDoc]);\n  const setLimit = useCallback((newLimit: number) => {\n    setPage(0);\n    setCurrentLimit(newLimit);\n    setCurrentQuery(query.limit(newLimit));\n  }, []);\n\n  return [items, next, previous, setLimit, isLoading, page, size];\n};\n\nexport default useFirestorePagination;\n"],"names":["useFirestorePagination","query","initialLimit","_a","useState","currentLimit","setCurrentLimit","_b","firstDoc","setFirstDoc","_c","lastDoc","setLastDoc","_d","limit","currentQuery","setCurrentQuery","_e","size","setSize","_f","items","setItems","_g","page","setPage","_h","isLoading","setLoading","useEffect","get","then","snapshot","docs","length","useCallback","startAfter","endBefore","limitToLast","newLimit"],"mappings":"2SAiBMA,uBAAyB,SAC7BC,EACAC,gBAAAA,MAEM,IAAAC,EAAkCC,eAASF,GAA1CG,OAAcC,OACfC,EAA0BH,iBAAzBI,OAAUC,OACXC,EAAwBN,iBAAvBO,OAASC,OACVC,EAAkCT,eAAgBH,EAAMa,MAAMZ,IAA7Da,OAAcC,OAEfC,EAAkBb,eAAS,GAA1Bc,OAAMC,OACPC,EAAoBhB,iBAAnBiB,OAAOC,OACRC,EAAkBnB,eAAS,GAA1BoB,OAAMC,OACPC,EAA0BtB,gBAAS,GAAlCuB,OAAWC,OA8BlB,OA5BAC,gBAAU,WACR5B,EAAM6B,MAAMC,KAAK,SAACC,GAAa,OAAAb,EAAQa,EAASd,SAC/C,IAEHW,gBAAU,WACRD,GAAW,GACXb,EAAae,MAAMC,KAAK,SAACC,GACvBJ,GAAW,GACXN,EAASU,GACTvB,EAAYuB,EAASC,KAAK,IAC1BrB,EAAWoB,EAASC,KAAKD,EAASC,KAAKC,OAAS,OAEjD,CAACnB,IAgBG,CAACM,EAdKc,kBAAY,WACvBV,EAAQ,SAACD,GAAS,OAAAA,EAAO,IACzBR,EAAgBf,EAAMmC,WAAWzB,GAASG,MAAMT,KAC/C,CAACM,IACawB,kBAAY,WAC3BV,EAAQ,SAACD,GAAS,OAAAA,EAAO,IACzBR,EAAgBf,EAAMoC,UAAU7B,GAAU8B,YAAYjC,KACrD,CAACG,IACa2B,kBAAY,SAACI,GAC5Bd,EAAQ,GACRnB,EAAgBiC,GAChBvB,EAAgBf,EAAMa,MAAMyB,KAC3B,IAEsCZ,EAAWH,EAAMN"}